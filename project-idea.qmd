---
title: "Project Idea"
author: "Matthew O'Stricker"
embed-resources: true
format: html
editor: visual
---

## Topic for Project

For my final project, I plan to answer the research question "What impact did the COVID-19 pandemic have on voter registration in the United States during the 2020 election?". To answer the question, I plan to use the `voter_registration` dataset from fivethirtyeight and the `covid_cases` dataset that has the covid cases recorded in 2020 in the United States from Our World in Data to analyze the voter registration numbers for each state. To measure the impact, I plan to compare the monthly trends for each state during the 2016 and 2020 election cycle to see if I can spot any key differences.

```{r}
#| message: false
library(tidyverse)
library(scales)
library(dplyr)
library(lubridate)
library(broom)
library(moderndive)
theme_set(theme_light())
voter_registration <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/new-voter-registrations.csv")
covid_cases <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/covid-cases.csv")
state_cases <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/Weekly_United_States_COVID-19_Cases_and_Deaths_by_State_-_ARCHIVED_20231109.csv")
us_population <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/united-states-population.csv")
glimpse(voter_registration)
florida_ex <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/Type%20of%20Registration.csv")
fl_tot <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/Voter%20Registration%20Applications%20Received%20by%20Source%20and%20County%202020%20total.csv")
fl_COVID <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/Use%20this%20for%20FL")
fl_pip <- read_csv("https://raw.githubusercontent.com/MatthewOStricker/soc223/main/FL-PIP.csv")

colnames(voter_registration) <- c("State", "Year", "Month", "NewRVoters")

month_order <- c("Jan", "Feb", "Mar", "Apr", "May")

voter_registration$Month <- factor(voter_registration$Month, levels = month_order)

florida_ex$Month <- factor(florida_ex$Month, levels = month_order)

fl_pip$Month <- factor(fl_pip$Month, levels = month_order)

voter_registration <- voter_registration |>
  filter(Month == "Jan" | Month == "Feb" | Month == "Mar" | Month == "Apr" ) 

names(state_cases)[names(state_cases) == "state"] <- "State"

  
state_cases <- state_cases |>
  filter(State == "AZ" | State == "CO" | State == "DE" | State == "DC" | State == "CA" | State == "DC"| State == "FL"| State == "GA"| State == "IL"| State == "MD"| State == "NC"| State == "TX"| State == "VA")


state_abb <- data.frame(
  StateName = state.name,
  StateAbb = state.abb,
  stringAsFactors = FALSE
)

voter_registration$State <- state_abb$StateAbb[match(voter_registration$State, state_abb$StateName)]

voter_registration$State <- ifelse(is.na(voter_registration$State), "DC", voter_registration$State)
```

```{r}
glimpse(covid_cases)
```

```{r}
glimpse(state_cases)
```

```{r}
state_cases <- state_cases |>
  mutate(date_updated = mdy(date_updated), 
         start_date = mdy(start_date), 
         end_date = mdy(end_date))
```

```{r}
  state_cases$end_date <- as.Date(state_cases$end_date)
  state_cases$Month <- month(ymd(state_cases$end_date), label = TRUE) 
  
state_cases <- state_cases |>
    filter(Month == "Apr" | Month == "Jan" | Month == "Feb" | Month == "Mar")
```

1.  General b/t 16 - 20
2.  Get all states covid data for 2020
    1.  Figure out what month is the highest peak for each state
    2.  lm(newvoter \~ octpeak)

# 1. Introduction

COVID-19 took the world by storm in 2020 and greatly altered so many key aspects of our daily lives. Outside of the many lives that were taken by the disease, the global pandemic created a shift in the very fabric of American democracy due to the implications it had on the U.S. presidential elections. The U.S. presidential election is a historic staple in American democracy that ultimately decides who will become the leader of the "free world" for the next four years. With the U.S. seeing a constant slight rise in recent years, the expectation is that there would be a constant rise in voter registration in the presidential elections.

To better analyze to see if this occurred and what caused the results that will be found, I plan to answer the research question "What impact did the COVID-19 pandemic have on voter registration in the United States during the 2020 election?". To answer the question, I plan to use the `voter_registration` dataset from fivethirtyeight and the `covid_cases` dataset that has the covid cases recorded in 2020 in the United States from Our World in Data to analyze the voter registration numbers for each state. To measure the impact, I plan to compare the monthly trends for each state during the 2016 and 2020 election cycle to see if I can spot any key differences.

Since COVID started to gain large traction in the United States in the earlier months of the year 2020, I will be focusing my analysis on Jan-May for the year 2020 and comparing that with the months Jan-May in 2016. The impacts of COVID, which was identified as a global pandemic and passed more than 100,000 deaths in the U.S., were apparent and we should be able to assess what impact, if any, it had on the voter registration in the country. (source: <https://www.usatoday.com/in-depth/news/nation/2020/04/21/coronavirus-updates-how-covid-19-unfolded-u-s-timeline/2990956001/>)

Please note, per the CDC, where the COVID-19 cases data was collected, "New York State's reported case and death counts do not include New York City's counts as they separately report nationally notifiable conditions to CDC." This explains why there is info for NY and NYC.

Additionally, only 11 states and Washington D.C. will be included in the datasets because those were the only places where fivethirtyeight was able to get data on new registered voters. I could not find any supplemental data for the other states. However, I believe the 12 jurisdictions will be able to accurately answer the aformentioned question.

# 2. Exploratory Data Analysis

```{r}
ggplot(us_population, aes(x = date, y = Population)) +
  geom_line() +
  geom_point() +
  labs(title = "Population Growth in the United States (2016-2020)",
       x = "Year",
       y = "Population") +
  scale_y_continuous(labels = comma)
```

Data shows that the population in the United States has been growing at a steady rate from 2016 to 2020. The constant growth leads me to hypothesize that there will be a growth in new voter registration numbers due to larger population in the United States.

```{r}
  summary_cases <- state_cases |>
    group_by(State, Month) |>
    summarise(
      Mean_cases = mean(new_cases),
      median_cases = median(new_cases),
      SD_cases = sd(new_cases),
    ) |>
    filter(Month <= "Apr") |>
    ungroup()
  
  
  print(summary_cases)
  
```

```{r}

ggplot(summary_cases, aes(x = Month, y = Mean_cases)) +
  geom_bar(stat = "identity", fill = "red") +
  labs(title = "Mean COVID-19 Cases by Month in the United States",
       x = "Month",
       y = "Mean COVID Cases") 
```

Create boxplot for the top 4 states with highest mean cases. Then focus analysis on those. Also do key example of florida later on.

```{r}
ggplot(voter_registration, aes(x = Month, y = NewRVoters, fill = as.factor(Year)))+
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) +
  facet_wrap(~Year) +
  labs(title = "Comparing the New Registered Voters in 2016 to 2020 from Jan-May",
       fill = "Year",
       y = "New Registered Voters")
```

```{r}
state_cases_reduced <- state_cases |>
  group_by(State, Month) |>
  summarise(TotalNewCases = sum(new_cases))
```

```{r}
COVID_Voter_2020 <- voter_registration |>
  filter(Year == "2020") 

COVID_Voter_2020$Year<- NULL

combined_COVID_Voter_2020 <- merge(COVID_Voter_2020, state_cases, by = c("State", "Month"), all = TRUE)

logtest <- combined_COVID_Voter_2020 |>
  filter(!(Month %in% c("Jan", "Feb")))

logtest <- logtest |>
  mutate(log_voters = log10(NewRVoters), 
         log_cases = log10(tot_cases)) 

ggplot(logtest, aes(x = log_cases, y = log_voters))+
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  scale_y_continuous(limits = c(0, 10))
```

```{r}
ggplot(state_cases, aes(x = tot_cases, y = tot_deaths))+
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

```{r}
fit1 <- lm(log_cases ~ log_voters, data = logtest) 

get_regression_table(fit1)
```

```{r}
coefficients <- coef(fit1)
print(coefficients)
```

```{r}
pred_data <- augment(fit1)

# glimpse our new data 
glimpse(pred_data)
```

```{r}
florida_ex <- florida_ex |>
  pivot_longer(cols = c(InPerson, Remote), names_to = "Variable", values_to = "Value")

ggplot(florida_ex, aes(x = Month, y = Value, color = Variable, group = Variable)) +
  geom_line(linewidth = 1.5)
```

```{r} 
  fit1 <- lm(pip ~ postcovid * MedianIncome, data = fl_pip)

  get_regression_table(fit1)
```

```{r}
  fit1 <- lm(pip ~ postcovid + MedianIncome, data = fl_pip)

  get_regression_table(fit1)
```

```{r}
ggplot(fl_pip, aes(x = MedianIncome, y = pip, color = factor(postcovid))) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Median Income", y = "PIP", color = "Post-COVID", title = "PIP vs. Median Income of Florida Country Registered Voters", subtitle = "Data from Counties in 2020 Pre- and Post-COVID Outbreak")  
```


b2(MedianIncome)

y = b0 + b1(postcovid) + b2(medinc) + b3(postcovid)
(MedianInome)

```{r}
pred_data <- augment(fit1)

glimpse(pred_data)

```

```{r}
ggplot(pred_data, aes(y = .resid)) + 
  geom_boxplot() + 
  labs(title = "Residuals from Registered Voter Analysis", y = "Residuals") +
  theme_minimal()